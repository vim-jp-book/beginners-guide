---
title: "モーション入門"
---

# はじめに

ほとんどのテキスト編集はカーソル移動から始まります。たとえば Vim で特定の場所にテキストを挿入するなら

1. 挿入したい場所にカーソルを移動する
2. 挿入モードに入り、所望のテキストを入力して挿入モードを抜ける

という手順を踏みます。削除や置換なども同様に、まずカーソルを移動してから次に操作を実行します。よってテキストを快適に編集したければ、まず快適にカーソル移動できなければ始まりません。カーソル移動は Vim を用いたテキスト編集の起点であり、要なのです。

このように重要なカーソル移動ですが、他エディタからすると Vim の移動方法は少々敷居が高いかもしれません。Vim でのカーソル移動は基本的にキーボードを用いて行われるからです。一般的なエディタでは、多くの場合マウスなどのポインティングデバイスを使用してカーソルを操作します。このようなキーボード指向のカーソル操作は、マウス指向の操作に比べて覚えることが多く、使いこなすためには特殊な訓練が必要であるかのように錯覚しがちです。

しかし、キーボード指向には良い面もあります。
マウス指向と比べ、キーボード指向のカーソル移動には以下のような利点があります。

- **ホームポジションから手を離す必要がない**。カーソル移動からシームレスに編集操作に移行できます。
- **視覚のフィードバックが不要**。マウス指向では、常にマウスカーソルの位置を視覚的に確認する必要があります。一方キーボード指向では、バッファの内容をある程度覚えてさえいれば多少カーソルが動いても位置を把握しつづけられるため、複数の操作を高速につなげることができます。
- **繰り返しが容易**。キーボード入力は簡単に再現できます。

パソコン操作の文脈から離れてより広く考えると、マウス指向は必ずしも王道ではないことが分かります。一般的な家庭用ゲーム機では、ボタンやスティック操作だけで快適にプレイヤーを操作できます。最近のゲーム機ではボタンが10個以上、操作のバリエーションで言えば20種類以上あることも珍しくありません。キーボードのような複雑さですが、一度操作に慣れれば格闘ゲームのコンボ技のように複雑な入力を一瞬で正確に行えるようになります。

多くのゲームと同じように、Vim を使っていけばだんだんと操作に慣れていきます。まずは基本操作を覚え、少しずつ複雑な操作も使えるようにしましょう。

本章では Vim の **モーション** と呼ばれるコマンドをいくつか紹介します。モーションを学ぶことで、Vim 上で快適にカーソル移動ができるようになります。モーションは 50 種類以上存在するものの、すべて覚える必要はありません。最初は前後左右に1マスずつ動くことしかできなくとも、慣れれば便利なモーションがたくさん使えるようになります。ここでは日常的に使う 24 種類に絞って紹介しますが、それだけでもかなり快適に移動できるようになるはずです。RPG ゲームの主人公のように、少しずつできることを増やしていきましょう。

# モーションとは

カーソル移動を行うコマンドのことを Vim では**モーション**と呼びます。モーションは以下の3通りの場面で使うことができます。

- **ノーマルモードにおけるカーソル移動**

  最も基本的なモーションの使い方です。ノーマルモードにおけるカーソル移動はほとんどモーションで行われます。

- **オペレータへの適用範囲指定**

  オペレータと一緒に用いることで、テキストの削除やインデントなどの編集を行う範囲を明示できます。オペレータを用いた編集操作については第x章で説明します。

- **ビジュアルモードにおける範囲の変更**

  ビジュアルモードの選択範囲を拡大・縮小するときにもモーションが使えます。

「カーソル移動をモーションと呼ぶ」と書きましたが、カーソル移動だけがモーションの仕事ではありません。「モーション」に分類されるコマンドなら、この3つの場面全てに使えることを覚えておいてください。

## 主要なモーション

特に使用頻度の高い、代表的なモーションを紹介します。説明のしやすさのため、以下の3種類に分けて紹介します。

- **横方向モーション**: 同一行内を移動するために用いられる以下のようなモーションです。
    - 1文字単位での移動
    - 単語 (word, WORD) 単位での移動 [^1]
    - 行頭、行末移動
    - `f` / `F`/ `t` / `T`
- **縦方向モーション**: 行をまたいで移動するために用いられる以下のようなモーションです。
    - 1行単位での移動
    - 段落単位での移動
    - ファイルの先頭行、最終行への移動
- **特殊なモーション**: 横/縦の枠にとらわれない、特殊なモーションです。

[^1]: 単語単位の移動は行をまたぐことができるため「横方向」と呼ぶのは正確ではなく、ヘルプでも区別されています。とはいえ現実的には横方向での移動が目的であることが多いため、ここでは横方向モーションの1つとして紹介します。

### 横方向モーション

|キー|効果         |例|
|----|-------------|-|
|`h` |左に1文字移動|![](/images/motion/horizontal-02.png)|
|`l` |右に1文字移動|![](/images/motion/horizontal-03.png)|
|`w` |後方の単語 (word) 頭に移動|![](/images/motion/horizontal-04.png)|
|`e` |後方の単語 (word) 終端に移動|![](/images/motion/horizontal-05.png)|
|`b` |前方の単語 (word) 頭に移動|![](/images/motion/horizontal-06.png)|
|`W` |後方の単語 (WORD) 頭に移動|![](/images/motion/horizontal-07.png)|
|`E` |後方の単語 (WORD) 終端に移動|![](/images/motion/horizontal-08.png)|
|`B` |前方の単語 (WORD) 頭に移動|![](/images/motion/horizontal-09.png)|
|`f{char}` | カーソル右の `{char}` がある場所に移動 |![](/images/motion/horizontal-10.png)|
|`t{char}` | カーソル右の `{char}` がある場所の1文字手前まで移動|![](/images/motion/horizontal-11.png)|
|`^` |行の非空白文字の先頭に移動| ![](/images/motion/horizontal-12.png)|
|`$` |行の末尾に移動|![](/images/motion/horizontal-13.png) |

:::details 少しマイナーな横方向モーション

こんなのもあるよ、という紹介です。筆者はあまり使っていませんが、知っておいても損はないので余裕があったら眺めてみてください。

|キー|効果         |備考|
|----|-------------|-|
|`ge` |前方の単語 (word) 終端に移動||
|`gE` |前方の単語 (WORD) 終端に移動||
|`F{char}` | カーソル左の `{char}` がある場所に移動 |`{char}` には任意の1文字が入る|
|`T{char}` | カーソル左の `{char}` がある場所の1文字後に移動 |`{char}` には任意の1文字が入る|
|`;` | 直前の `f` / `t` / `F` / `T` を順方向に繰り返す ||
|`,` | 直前の `f` / `t` / `F` / `T` を逆方向に繰り返す ||
|`0` |行の先頭に移動| |
|`g_` |行の非空白文字の末尾に移動| |

:::

- `h` と `l` は1文字単位で移動するモーションです。
    - 最も小回りがきく反面、大きな距離の移動には不向きです。
    - 単語単位・行頭行末モーションで大雑把に移動してから微調整する、といった形で使うのがおすすめです。

- `w` / `e` / `b` は word 単位で移動するモーションです。
    - word の定義は言語により異なりますが、多くの言語では英数字やアンダースコアで構成された文字列が単語とみなされます [^2]。
    - 行をまたいでの移動もできます。

- `W` / `E` / `B` は WORD 単位で移動するモーションです。
    - WORD とは、空白文字で区切られた塊に相当する単位です。
    - word より1つ1つの塊が大きいため、 `w` / `e` / `b` よりも大雑把に移動できます。
    - 行をまたいでの移動もできます。

- `^` は行頭に移動するモーション、 `$` は行末に移動するモーションです。
    - 正規表現と関連付けて覚えるのがおすすめです。正規表現では `^` が文字列の最初、 `$` が文字列の最後を表す特殊文字ですね。

- `f` / `t` / `F` / `T` は特徴的なモーションであり、一言で言えば「行内のみで有効な簡易検索」です。
    - これらのコマンドは単体では機能せず、直後に検索文字を指定することではじめて「その文字を検索して見つかったところに移動する」モーションとして機能します。
        - たとえば `f.` と打てば、カーソルより右のピリオドまで移動することができます。カーソルより右側にピリオドがなければ、どこにも移動しません。
    - 最低2ストローク必要ですが、条件が揃えば2ストロークだけで行きたい場所を狙い撃ちできる、非常に汎用的で強力なモーションです。一度コツを掴めば様々な場面で活躍します。
    - 同一行の範囲でのみ有効であり、行をまたいでの移動はできません。裏を返せば、行外の遠く離れた場所に意図せず飛んでしまう心配がないともいえます。


[^2]: より正確には、`'iskeyword'` というオプションによりどの文字を単語の要素とみなすかが決まります。`'iskeyword'` オプションは ftplugin というファイルタイプ毎の設定で記述されるケースが多いため、「言語により異なる」と書いていますが、ユーザ側で定義し直すことも可能です。

### 縦方向のモーション

|キー|効果         |
|----|-------------|
|`j` |下に1行移動|
|`k` |上に1行移動|
|`{` |手前の段落の境界に移動|
|`}` |直後の段落の境界に移動|
|`gg` |バッファ先頭行に移動|
|`G` |バッファ最終行に移動|
|`:{number}<CR>` |`{number}` 行目に移動|

- 段落とは空行で区切られたカタマリを指します。

- `:{number}<CR>` はコマンドラインモードに入ってから数字のみを入力してコマンドラインモードを抜けることを意味します。
    実はコマンドラインモードで数字だけを入力すると、その行にジャンプすることができます。

### 特殊なモーション

|キー|効果         |備考|
|----|-------------|-|
|`%` | 対応する括弧に移動 | |
|`/{query}<CR>` |検索クエリ `{query}` に最初に合致する箇所に移動 |`{query}` には任意の Vim 正規表現が入る|


- `%` コマンドを使うと、 `( )` `[ ]` `{ }` といった括弧の組を認識し、反対側に飛ぶことができます。
    - どんなに離れていても、括弧の対応さえ取れていれば対応する括弧の反対側に移動できます。

- 検索も「検索クエリに合致した場所にカーソルを移動させる」コマンドなので、モーションの一種です。
    - 検索コマンドの使い方については第x章を参照。

# モーションの関連機能

## カウント

Vim のコマンドは数値を前置して回数を指定できます。
たとえばノーマルモードで `5j` と打てば、一度に5行下に移動することができます。
同様に `10w` で10単語先に、 `3f.` でカーソル位置から数えて3番目の `.` に飛びます。
この `5`, `10`, `123` といった数字を**カウント (count)** と呼びます。

ただし `gg` や `G` では、カウントが行番号に対応します。たとえば `5gg` や `5G` とすれば5行目に移動します。このようにコマンドによってはカウントが「回数」を意味しない場合もあるので注意しましょう。

:::message

##### Tips: 独自キーマップでカウントを使う

カウントを使って大雑把に移動するコマンドを自分で定義することもできます。たとえば以下のような設定を `.vimrc` に書けば、 `<C-j>` を押すことで10行下に移動できるようになります。

```vim
nnoremap <C-j> 10j
nnoremap <C-k> 10k
```

`nnoremap` はカスタムのキーマップを定義する Vim script のコマンドです。
設定方法については第x章を参照してください。

:::

:::message
##### Tips: `%` モーションとカウント

`%` モーションは特殊で、カウント $n$ を前置すると「開いているファイルの $n$ パーセントの行」に飛ぶことができます。たとえば10000行からなるファイルで `5%` と打てば、500行目にカーソルが移動します。知っていると役立つときがある…かもしれません。
:::

## テキストオブジェクト

モーションと似た概念に「テキストオブジェクト」というものがあります。 `iw` や `a)` といったコマンドに見覚えがあるかもしれません。これらはモーションではなく、テキストオブジェクトです。
どちらもオペレータの直後で指定できるという共通点はあるものの、以下のような違いがあります。

- モーション
    - 「カーソル移動」を表す概念。
    - ノーマルモードでのカーソル移動に使用できる。
    - ビジュアルモードで用いた場合、選択範囲の開始位置・終了位置の片方しか動かない。
- テキストオブジェクト
    - 「テキストの選択範囲」を表す概念。
    - ノーマルモードでのカーソル移動には基本的に使用できない。
    - ビジュアルモードで用いた場合、選択範囲の開始位置・終了位置の両方が動く。

詳しくは第x章で説明します。

# モーションを使いこなすために意識したいこと

## 効率良く移動する

Vim キーバインドの代名詞とも言える `h` `j` `k` `l` ですが、それだけではあまり高速には移動できません。効率的に移動するためには、様々なモーションを場面に応じて使い分ける必要があるのです。効率を上げるためのコツをいくつか紹介します。

1. 大雑把に移動してから細かい移動で微調整する。

    - よくある例:
        - 所望の段落まで `}` で移動してから、 `j` / `k` で所望の行になるよう調整する
        - 所望の単語まで `w` や `W` で移動してから、 `h` / `l` で微調整する
        - 一旦 `$` で行末まで移動してから、 `b` で何単語か遡る

2. 縦方向に移動してから横方向に移動する。

    - ファイルの中での行の長さは通常バラバラですから、縦一直線に移動しようとしてもうまくいきません。
    - カーソルの位置を正確に合わせたければ、まず縦方向モーションで行番号を正確に合わせ、続いて横方向モーションで列を合わせましょう。

3. ピンポイントで移動する手もある。

    - 目的の位置が離れていたりすぐに見つからなかったりする場合は、検索コマンド `/` を活用しましょう。Vim の検索コマンドは気軽に利用できるため、カーソル移動のためだけに検索を使うことも多々あります。
    - 同一行内で離れた場所に移動したければ `f` / `t` / `F` / `T` が有力です。うまくいけば、検索コマンドより短いストロークで所望の位置にぴったり飛ぶことができます。
    - 行数などが分かっている場合、カウント指定も有効です。たとえば42行目に飛びたいと予め分かっているなら `:42<CR>` や `42gg` で直接移動できます。

## 効率を求めすぎない

日常の編集において、必ずしも最小のストローク数を目指す必要はありません。はじめから完璧な効率を目指す必要もありませんし、不可能です。最適な手を考えている暇があるなら、その時間を使って多少非効率でも手を動かした方が早いケースは多々あります。

## モーションの種類が多い理由

冒頭で、Vim のモーションは 50 種類以上あると述べました。中には、2つのモーションを組み合わせれば実現できそうなものもあります。たとえば `t.` は「次の `.` の1文字手前」に飛ぶのですから、 `f.h` と打っても（その行にピリオドがあるなら）ほとんどのケースで同じ結果になるはず。どうしてわざわざ `f` だけでなく `t` コマンドを用意したのでしょうか？

これにはちゃんとした理由があります。理由が気になる方は、第x章と第x章を読んでみてください。

# おわりに

本章では、Vim におけるカーソル移動であるモーションについて説明しました。冒頭で述べた通り、ここでは説明しなかったモーションもまだ沢山あります。使えるモーションの数は Vimmer にとっての移動手段であり、強力な武器でもあります。`:h motion.txt` などを参照しつつ、武器を増やしていってください。

（執筆者: [@monaqa](https://github.com/monaqa)）
